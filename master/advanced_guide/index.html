<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Guide &mdash; gama 21.0.1.dev documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/Color-Transparent.svg"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API" href="../api/index.html" />
    <link rel="prev" title="User Guide" href="../user_guide/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/Logo-on-white-text-on-transparent.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                21.0.1.dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#automl-pipeline">AutoML Pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#search-algorithms">Search Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#post-processing">Post-processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-automl-pipeline">Configuring the AutoML pipeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gama-search-space-configuration">GAMA Search Space Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#events">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#developers-notes">Developers Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-your-own-search-or-postprocessing">Adding Your Own Search or Postprocessing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#search">Search</a></li>
<li class="toctree-l4"><a class="reference internal" href="#postprocessing">PostProcessing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark.html">Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Papers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">gama</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Advanced Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/advanced_guide/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="advanced-guide">
<span id="advanced-guide-index"></span><h1>Advanced Guide<a class="headerlink" href="#advanced-guide" title="Permalink to this heading"></a></h1>
<p>For a basic introduction to GAMA, read the <a class="reference internal" href="../user_guide/index.html#user-guide-index"><span class="std std-ref">User Guide</span></a> first.
This section will cover more advanced usage of GAMA, in particular it covers:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Ways to configure GAMA, such as:</dt><dd><ul>
<li><p>A description of non-default AutoML steps and how to configure them.</p></li>
<li><p>Configuring the search space.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Interfacing with GAMA:</dt><dd><ul>
<li><p>An introduction to optimization traces and visualizing them.</p></li>
<li><p>GAMA’s Events.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Developers notes:</dt><dd><ul>
<li><p>A project overview.</p></li>
<li><p>How to add a search or post processing step.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<hr class="docutils" />
<section id="automl-pipeline">
<h2>AutoML Pipeline<a class="headerlink" href="#automl-pipeline" title="Permalink to this heading"></a></h2>
<p>An AutoML system performs several operations in its search for a model, and each of them may have several options and hyperparameters.
An important decision is picking the search algorithm, which performs search over machine learning pipelines for your data.
Another choice would be how to construct a model after search, e.g. by training the best pipeline or constructing an ensemble.
Similarly to how data processing algorithms can form a <em>machine learning pipeline</em>,
we will refer to a configuration of these AutoML components as an <em>AutoML Pipeline</em>.
In GAMA we currently support flexibility in the AutoML pipeline in two stages: search and post-processing.
See <a class="reference internal" href="#add-your-own"><span class="std std-ref">Adding Your Own Search or Postprocessing</span></a> for more information on how to add your own.</p>
<section id="search-algorithms">
<h3>Search Algorithms<a class="headerlink" href="#search-algorithms" title="Permalink to this heading"></a></h3>
<p>The following search algorithms are available in GAMA:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Random</span> <span class="pre">Search</span></code>: Randomly pick machine learning pipelines from the search space and evaluate them.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Asynchronous</span> <span class="pre">Evolutionary</span> <span class="pre">Algorithm</span></code>: Evolve a population of machine learning pipelines, drawing new machine learning pipelines from the best of the population.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Asynchronous</span> <span class="pre">Successive</span> <span class="pre">Halving</span> <span class="pre">Algorithm</span></code>: A bandit-based approach where many machine learning pipelines iteratively get evaluated and eliminated on bigger fractions of the data.</p></li>
</ul>
</section>
<section id="post-processing">
<h3>Post-processing<a class="headerlink" href="#post-processing" title="Permalink to this heading"></a></h3>
<p>The following post-processing steps are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code>: no post-processing will be done. This means no final pipeline will be trained and <cite>predict</cite> and <cite>predict_proba</cite> will be unavailable. This can be interesting if you are only interested in the search procedure.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FitBest</span></code>: fit the single best machine learning pipeline found during search.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>: create an ensemble out of evaluated machine learning pipelines. This requires more time but can lead to better results.</p></li>
</ul>
</section>
<section id="configuring-the-automl-pipeline">
<h3>Configuring the AutoML pipeline<a class="headerlink" href="#configuring-the-automl-pipeline" title="Permalink to this heading"></a></h3>
<p>By default ‘prepend pipeline’, ‘Asynchronous EA’ and ‘FitBest’ are chosen for pre-processing, search and post-processing, respectively.
However, it is easy to change this, or to change the hyperparameters with which each component is used.
For example, searching with ‘Asynchronous Successive Halving’ and creating an ensemble during post-processing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gama</span> <span class="kn">import</span> <span class="n">GamaClassifier</span>
<span class="kn">from</span> <span class="nn">gama.search_methods</span> <span class="kn">import</span> <span class="n">AsynchronousSuccessiveHalving</span>
<span class="kn">from</span> <span class="nn">gama.postprocessing</span> <span class="kn">import</span> <span class="n">EnsemblePostProcessing</span>

<span class="n">custom_pipeline_gama</span> <span class="o">=</span> <span class="n">GamaClassifier</span><span class="p">(</span><span class="n">search</span><span class="o">=</span><span class="n">AsynchronousSuccessiveHalving</span><span class="p">(),</span> <span class="n">post_processing</span><span class="o">=</span><span class="n">EnsemblePostProcessing</span><span class="p">())</span>
</pre></div>
</div>
<p>or using ‘Asynchronous EA’ but with custom hyperparameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gama</span> <span class="kn">import</span> <span class="n">GamaClassifier</span>
<span class="kn">from</span> <span class="nn">gama.search_methods</span> <span class="kn">import</span> <span class="n">AsyncEA</span>

<span class="n">custom_pipeline_gama</span> <span class="o">=</span> <span class="n">GamaClassifier</span><span class="p">(</span><span class="n">search</span><span class="o">=</span><span class="n">AsyncEA</span><span class="p">(</span><span class="n">population_size</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
</section>
<section id="gama-search-space-configuration">
<span id="search-space-configuration"></span><h2>GAMA Search Space Configuration<a class="headerlink" href="#gama-search-space-configuration" title="Permalink to this heading"></a></h2>
<p>By default GAMA will build pipelines out of scikit-learn algorithms, both for preprocessing and learning models.
It is possible to modify this search space, changing the algorithms or hyperparameter ranges to consider.</p>
<p>The search space is determined by the <cite>search_space</cite> dictionary passed upon initialization.
The defaults are found in
<a class="reference external" href="https://github.com/openml-labs/gama/tree/master/gama/configuration/classification.py">classification.py</a> and
<a class="reference external" href="https://github.com/openml-labs/gama/tree/master/gama/configuration/regression.py">regression.py</a>
for the GamaClassifier and GamaRegressor, respectively.</p>
<p>A sample of algorithms that GAMA uses by default:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html">logistic regression</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html">random forest classifier</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/naive_bayes.html">naive bayes</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html#sklearn.svm.SVC">support vector machines</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">PCA</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.Normalizer.html">normalization</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.FastICA.html">ICA</a></p></li>
</ul>
</div></blockquote>
<p>The search space configuration is defined in a python dictionary.
For reference, a minimal example search space configuration can look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">BernoulliNB</span>
<span class="n">search_space</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">],</span>
    <span class="n">BernoulliNB</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;fit_prior&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At the top level, allowed key types are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">string</span></code>, with a list as value.</p></li>
</ul>
<blockquote>
<div><p>It specifies the name of a hyperparameter with its possible values.
By defining a hyperparameter at the top level, you can reference it as hyperparameter for any specific algorithm.
To do so, identify it with the same name and set its possible values to an empty list (see <cite>alpha</cite> in the example).
The benefit of doing is that multiple algorithms can share a hyperparameter space that is defined only once.
Additionally, in evolution this makes it possible to know which hyperparameter values can be crossed over between
different algorithms.</p>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">class</span></code>, with a dictionary as value.</p></li>
</ul>
<blockquote>
<div><p>The key specifies the algorithm, calling it should instantiate the algorithm.
The dictionary specifies the hyperparameters by name and their possible values as list.
All hyperparameters specified should be taken as arguments for the algorithm’s initialization.
A hyperparameter specified at the top level of the dictionary can share a name with a hyperparameter of the algorithm.
To use the values provided by the shared hyperparameter, set the possible values to an empty list.
If a list of values is provided instead, it will not use the shared hyperparameter values.</p>
</div></blockquote>
<hr class="docutils" />
</section>
<section id="logging">
<span id="logging-section"></span><h2>Logging<a class="headerlink" href="#logging" title="Permalink to this heading"></a></h2>
<p>GAMA makes use of the default Python <a class="reference external" href="https://docs.python.org/3.5/library/logging.html">logging</a> module.
This means logs can be captured at different levels, and handled by one of several StreamHandlers.</p>
<p>The most common logging use cases are to write a comprehensive log to file, as well as print important messages to <code class="code docutils literal notranslate"><span class="pre">stdout</span></code>.
Writing log messages to <code class="code docutils literal notranslate"><span class="pre">stdout</span></code> is directly supported by GAMA through the <code class="code docutils literal notranslate"><span class="pre">verbosity</span></code> hyperparameter
(which defaults to <code class="code docutils literal notranslate"><span class="pre">logging.WARNING</span></code>).</p>
<p>By default GAMA will also save several different logs.
This can be turned off by the <code class="code docutils literal notranslate"><span class="pre">store</span></code> hyperparameter.
The <code class="code docutils literal notranslate"><span class="pre">store</span></code> hyperparameter allows you to store the logs, as well as models and predictions.
By default logs are kept (which includes evaluation data), but models and predictions are discarded.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">output_directory</span></code> hyperparameter determines where this data is stored, by default a unique name is generated.
In the output directory you will find three files and a subdirectory:</p>
<blockquote>
<div><ul class="simple">
<li><p>‘evaluations.log’: a csv file (with ‘;’ as separator) in which each evaluation is stored.</p></li>
<li><p>‘gama.log’: A loosely structured file with general (human readable) information of the GAMA run.</p></li>
<li><p>‘resources.log’: A record of the memory usage for each of GAMA’s processes over time.</p></li>
<li><p>cache directory: contains evaluated models and predictions, only if <code class="code docutils literal notranslate"><span class="pre">store</span></code> is ‘all’ or ‘models’</p></li>
</ul>
</div></blockquote>
<p>If you want other behavior, the logging module offers you great flexibility on making your own variations.
The following script writes any log messages of <code class="code docutils literal notranslate"><span class="pre">logging.DEBUG</span></code> or up to both file and console:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">gama</span> <span class="kn">import</span> <span class="n">GamaClassifier</span>

<span class="n">gama_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;gama&#39;</span><span class="p">)</span>
<span class="n">gama_log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">fh_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s1">&#39;logfile.txt&#39;</span><span class="p">)</span>
<span class="n">fh_log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">gama_log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh_log</span><span class="p">)</span>

<span class="c1"># The verbosity hyperparameter sets up an StreamHandler to `stdout`.</span>
<span class="n">automl</span> <span class="o">=</span> <span class="n">GamaClassifier</span><span class="p">(</span><span class="n">max_total_time</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="s2">&quot;nothing&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the above script will create the ‘logfile.txt’ file with all log messages that could also be seen in the console.
An overview the log levels:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">DEBUG</span></code>: Messages for developers.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">INFO</span></code>: General information about the optimization process.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">WARNING</span></code>: Serious errors that do not prohibit GAMA from running to completion (but results could be suboptimal).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">ERROR</span></code>: Errors which prevent GAMA from running to completion.</p></li>
</ul>
</div></blockquote>
<p>As described in <a class="reference internal" href="../user_guide/index.html#dashboard-section"><span class="std std-ref">Dashboard</span></a> the files in the output directory can be used to generate visualizations about the optimization process.</p>
</section>
<hr class="docutils" />
<section id="events">
<h2>Events<a class="headerlink" href="#events" title="Permalink to this heading"></a></h2>
<p>It is also possible to programmatically receive updates of the optimization process through the events:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gama</span> <span class="kn">import</span> <span class="n">GamaClassifier</span>

<span class="k">def</span> <span class="nf">print_evaluation</span><span class="p">(</span><span class="n">evaluation</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">evaluation</span><span class="o">.</span><span class="n">individual</span><span class="o">.</span><span class="n">pipeline_str</span><span class="p">()</span><span class="si">}</span><span class="s1"> was evaluated. Fitness is </span><span class="si">{</span><span class="n">evaluation</span><span class="o">.</span><span class="n">score</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>

<span class="n">automl</span> <span class="o">=</span> <span class="n">GamaClassifier</span><span class="p">()</span>
<span class="n">automl</span><span class="o">.</span><span class="n">evaluation_completed</span><span class="p">(</span><span class="n">print_evaluation</span><span class="p">)</span>
<span class="n">automl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>The function passed to <code class="docutils literal notranslate"><span class="pre">evaluation_completed</span></code> should take a <code class="docutils literal notranslate"><span class="pre">gama.genetic_programming.utilities.evaluation_library.Evaluation</span></code>
as single argument.
Any exceptions raised but not handled in the callback will be ignored but logged at <code class="docutils literal notranslate"><span class="pre">logging.WARNING</span></code> level.
During the callback a <code class="docutils literal notranslate"><span class="pre">stopit.utils.TimeoutException</span></code> may be raised.
This signal normally indicates to GAMA to move on to the next step in the AutoML pipeline.
If caught by the callback, GAMA may exceed its allotted time.
For this reason, it is advised to keep callbacks short after catching a <code class="docutils literal notranslate"><span class="pre">stopit.utils.TimeoutException</span></code>.
If the <code class="docutils literal notranslate"><span class="pre">stopit.utils.TimeoutException</span></code> is not caught, GAMA will correctly terminate its step in the AutoML pipeline
and continue as normal.</p>
</section>
<hr class="docutils" />
<section id="developers-notes">
<h2>Developers Notes<a class="headerlink" href="#developers-notes" title="Permalink to this heading"></a></h2>
<section id="adding-your-own-search-or-postprocessing">
<span id="add-your-own"></span><h3>Adding Your Own Search or Postprocessing<a class="headerlink" href="#adding-your-own-search-or-postprocessing" title="Permalink to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is not set in stone. As more AutoML pipeline steps are added by more people,
we expect to identify parts of the interface to be improved. We can’t do this without your feedback!
Feel free to get in touch, preferably in the form of a public discussion on a Github issue, and let us
know what difficulties you encounter, or what works well!</p>
</div>
<p>This section contains information about implementing your own Search or Postprocessing procedures.
To keep interfaces uniform across the different search or postprocesing implementations, each should derive from their respective baseclass (<code class="code docutils literal notranslate"><span class="pre">BaseSearch</span></code> and <code class="code docutils literal notranslate"><span class="pre">BasePostProcessing</span></code>).
They each have their own processing method (<code class="code docutils literal notranslate"><span class="pre">search</span></code> for <code class="code docutils literal notranslate"><span class="pre">BaseSearch</span></code> and <code class="code docutils literal notranslate"><span class="pre">post_process</span></code> for <code class="code docutils literal notranslate"><span class="pre">BasePostProcessing</span></code>) which should be implemented.
We will show example implementations further down.</p>
<p>Your Search or Postprocessing algorithm may feature hyperparameters, care should be taken to provide good default values.
For some algorithms, hyperparameter default values are best specified based on characteristics of the dataset.
For instance, with big datasets it might be useful to perform (some of) the workload on a subset of the data.
We refer to these data-dependent non-static defaults as ‘dynamic defaults’.
Both <code class="code docutils literal notranslate"><span class="pre">BaseSearch</span></code> and <code class="code docutils literal notranslate"><span class="pre">BasePostProcessing</span></code> feature a <code class="code docutils literal notranslate"><span class="pre">dynamic_defaults</span></code> method which is called before <code class="code docutils literal notranslate"><span class="pre">search</span></code> and <code class="code docutils literal notranslate"><span class="pre">...</span></code>, respectively.
This allows you to overwrite default hyperparameter values based on the dataset properties.
The hyperparameter values with which your search or postprocessing will be called is determined in the following order:</p>
<blockquote>
<div><ul class="simple">
<li><p>User specified values are used if specified (e.g. <code class="code docutils literal notranslate"><span class="pre">EnsemblePostProcessing(n=25)</span></code>)</p></li>
<li><p>Otherwise the values determined by <code class="code docutils literal notranslate"><span class="pre">dynamic_defaults</span></code> are used</p></li>
<li><p>If neither are specified, the static default values are used.</p></li>
</ul>
</div></blockquote>
<section id="search">
<h4>Search<a class="headerlink" href="#search" title="Permalink to this heading"></a></h4>
<p>To implement your own search procedure, create a class which derives from the base class:</p>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">gama.search_methods.base_search.</span></span><span class="sig-name descname"><span class="pre">BaseSearch</span></span><a class="reference internal" href="../_modules/gama/search_methods/base_search.html#BaseSearch"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>All search methods should be derived from this class.
This class should not be directly used to configure GAMA.</p>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">dynamic_defaults</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Series</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_limit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><span class="pre">float</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/gama/search_methods/base_search.html#BaseSearch.dynamic_defaults"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Set hyperparameter defaults based on the dataset and time-constraints.</p>
<p>Should be called before <code class="code docutils literal notranslate"><span class="pre">search</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>pandas.DataFrame</em>) – Features of the data.</p></li>
<li><p><strong>y</strong> (<em>pandas.DataFrame</em><em> or </em><em>pandas.Series</em>) – Labels of the data.</p></li>
<li><p><strong>time_limit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Time in seconds available for search and selecting dynamic defaults.
There is no need to adhere to this explicitly,
a <code class="code docutils literal notranslate"><span class="pre">stopit.utils.TimeoutException</span></code> will be raised.
The time-limit might be an important factor in setting hyperparameter values</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">hyperparameters</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.10)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></em></dt>
<dd><p>Hyperparameter (name, value) pairs as set/determined dynamically/default.</p>
<p>Values may have been set directly, through dynamic defaults or static defaults.
This is also the order in which the value of a hyperparameter is checked,
i.e. a user set value wil overwrite any other value, and a dynamic default
will overwrite a static one.
Dynamic default values only considered if <code class="code docutils literal notranslate"><span class="pre">dynamic_defaults</span></code> has been called.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">operations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">OperatorSet</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_candidates</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../api/index.html#gama.genetic_programming.components.Individual" title="gama.genetic_programming.components.individual.Individual"><span class="pre">Individual</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gama/search_methods/base_search.html#BaseSearch.search"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Execute search as configured.</p>
<p>Sets <code class="code docutils literal notranslate"><span class="pre">output</span></code> field of this class to the best Individuals.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>operations</strong> (<em>OperatorSet</em>) – Has methods to create new individuals, evaluate individuals and more.</p></li>
<li><p><strong>start_candidates</strong> (<em>List</em><em>[</em><a class="reference internal" href="../api/index.html#gama.genetic_programming.components.Individual" title="gama.genetic_programming.components.Individual"><em>Individual</em></a><em>]</em>) – A list of individuals to be considered before all others.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>You can use existing search implementations as a reference.</p>
<section id="init">
<h5><code class="code docutils literal notranslate"><span class="pre">__init__</span></code><a class="headerlink" href="#init" title="Permalink to this heading"></a></h5>
<p>To allow us to identify which hyperparameters are set by the user, and which are defaults, the default values for each hyperparameter in the <code class="code docutils literal notranslate"><span class="pre">__init__</span></code> method should be <code class="code docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>In search methods, each evaluation of a machine learning pipeline is logged automatically.
Default data recorded includes:</p>
<blockquote>
<div><ul class="simple">
<li><p>a string representation of the pipeline</p></li>
<li><p>the scores of the pipeline according to the specified metrics</p></li>
<li><p>any errors that occurred during evaluation</p></li>
</ul>
</div></blockquote>
<p>It is possible to add additional fields to be recorded for each pipeline, as shown here.
The <code class="code docutils literal notranslate"><span class="pre">extra_fields</span></code> of the <code class="code docutils literal notranslate"><span class="pre">EvaluationLogger</span></code> expects a dictionary,
which maps the name of a field to the method which extracts the information that should be recorded.
In this case we are interested to know the parent of each evaluated pipeline, so we might later inspect a pipeline’s “lineage”.</p>
</section>
<section id="dynamic-defaults">
<h5><code class="code docutils literal notranslate"><span class="pre">dynamic_defaults</span></code><a class="headerlink" href="#dynamic-defaults" title="Permalink to this heading"></a></h5>
<p>Hyperparameters such as population size might make for good candidates for dynamic defaults.
However it is not obvious what the relationship should be.
For this reason, we choose not to work with dynamic defaults in this search strategy.
Perhaps in the future, when we have adequate data to model the relationship we can determine useful default values.</p>
<p>You can find an example usage of dynamic defaults in the Asynchronous Successive Halving Algorithm search.</p>
</section>
<section id="id2">
<h5><code class="code docutils literal notranslate"><span class="pre">search</span></code><a class="headerlink" href="#id2" title="Permalink to this heading"></a></h5>
<p>This method should execute the search for a good machine learning pipeline.
The search should always take into account the <code class="code docutils literal notranslate"><span class="pre">start_candidates</span></code> in some form.
This allows the search start point to be set by the user or a warm start step.
In this evolutionary optimization, they form the initial population.</p>
<p>The search algorithm should update the <code class="code docutils literal notranslate"><span class="pre">output</span></code> field of the <code class="code docutils literal notranslate"><span class="pre">Search</span></code> object, and behave nicely when interrupted with a <code class="code docutils literal notranslate"><span class="pre">TimeoutException</span></code>.
This allows GAMA to control when to shut down search (and continue with post processing).</p>
</section>
</section>
<section id="postprocessing">
<h4>PostProcessing<a class="headerlink" href="#postprocessing" title="Permalink to this heading"></a></h4>
<p>PostProcessing follows a similar pattern, where the class should allow initialization with its hyperparameters,
an implementation of dynamic defaults (optional), and a <code class="code docutils literal notranslate"><span class="pre">post_process</span></code> function.</p>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">gama.postprocessing.</span></span><span class="sig-name descname"><span class="pre">BasePostProcessing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time_fraction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><span class="pre">float</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gama/postprocessing/base_post_processing.html#BasePostProcessing"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>All post-processing methods should be derived from this class.
This class should not be directly used to configure GAMA.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>time_fraction</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Fraction of total time that to be reserved for this post-processing step.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">dynamic_defaults</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gama</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Gama</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/gama/postprocessing/base_post_processing.html#BasePostProcessing.dynamic_defaults"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Configure the post-processing technique based on GAMA properties.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">hyperparameters</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.10)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></em></dt>
<dd><p>Hyperparameter (name, value) pairs.</p>
<p>Value determined by user &gt; dynamic default &gt; static default.
Dynamic default values only considered if <code class="code docutils literal notranslate"><span class="pre">dynamic_defaults</span></code> has been called.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">post_process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Series</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../api/index.html#gama.genetic_programming.components.Individual" title="gama.genetic_programming.components.individual.Individual"><span class="pre">Individual</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.10)"><span class="pre">object</span></a></span></span><a class="reference internal" href="../_modules/gama/postprocessing/base_post_processing.html#BasePostProcessing.post_process"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>pd.DataFrame</em>) – all training features</p></li>
<li><p><strong>y</strong> (<em>Union</em><em>[</em><em>pd.DataFrame</em><em>, </em><em>pd.Series</em><em>]</em>) – all training labels</p></li>
<li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – allowed time in seconds for post-processing</p></li>
<li><p><strong>selection</strong> (<em>List</em><em>[</em><a class="reference internal" href="../api/index.html#gama.genetic_programming.components.Individual" title="gama.genetic_programming.components.Individual"><em>Individual</em></a><em>]</em>) – individuals selected by the search space, ordered best first</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A model with <code class="code docutils literal notranslate"><span class="pre">predict</span></code> and optionally <code class="code docutils literal notranslate"><span class="pre">predict_proba</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Any</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">to_code</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">preprocessing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.10)"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">TransformerMixin</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a></span></span><a class="reference internal" href="../_modules/gama/postprocessing/base_post_processing.html#BasePostProcessing.to_code"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Generate Python code to reconstruct a pipeline that constructs the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>preprocessing</strong> (<em>Sequence</em><em>[</em><em>TransformerMixin</em><em>]</em><em>, </em><em>optional</em><em> (</em><em>default=None</em><em>)</em>) – Preprocessing steps that need be executed before the model.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A string of Python code that sets a ‘pipeline’ variable to the pipeline that
defines the final pipeline generated by post-processing.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>Unlike the search methods, which are not required to have any hyperparameter, post processing is required to have a default value for <code class="code docutils literal notranslate"><span class="pre">time_fraction</span></code>.
<code class="code docutils literal notranslate"><span class="pre">time_fraction</span></code> is the fraction of the total time that should be reserved for the post processing method (as set on initialization through <code class="code docutils literal notranslate"><span class="pre">max_total_time</span></code>).
For instance, when a post-processing object’s <code class="code docutils literal notranslate"><span class="pre">time_fraction</span></code> is <code class="code docutils literal notranslate"><span class="pre">0.3</span></code> and GAMA is initiated with <code class="code docutils literal notranslate"><span class="pre">max_total_time=3600</span></code>,
then <code class="code docutils literal notranslate"><span class="pre">3600*0.3=1080</span></code> seconds are reserved for the post-processing phase.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While hard, it is important to provide an accurate estimate for <code class="code docutils literal notranslate"><span class="pre">time_fraction</span></code>. If you reserve too much time,
it means that the search procedure will have to be cut off unnecessarily early. If too little time is reserved,
GAMA will interrupt the post-processing step and return control to the user.
It is generally hard to know to how much to reserve, and is likely dependent on the dataset and number of evaluated
pipelines in search. We would like to implement ways in which post-processing methods have access to these
statistics and allow them to update their time estimate, so that less time is wasted on too long or too short
post-processing phases.</p>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../user_guide/index.html" class="btn btn-neutral float-left" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api/index.html" class="btn btn-neutral float-right" title="API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2022, Pieter Gijsbers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>